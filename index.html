<!DOCTYPE html> 
<html>
	<head>
		<title>How-to Saml</title>
	</head>
	<link rel="stylesheet" type="text/css" href="//npmcdn.com/bootstrap@4.0.0-alpha.5/dist/css/bootstrap.min.css"/>
	<link rel="stylesheet" type="text/css" href="lib/highlight/styles/default.css"/>

	<script
			  src="https://code.jquery.com/jquery-3.1.1.min.js"
			  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
			  crossorigin="anonymous"></script>
	<script type="//npmcdn.com/tether@1.2.4/dist/js/utils.js"></script>
	<script src="//npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>

	<script type="text/javascript" src="//npmcdn.com/bootstrap@4.0.0-alpha.5/dist/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="lib/highlight/highlight.pack.js"></script>
	<script type="text/javascript" src="lib/bootstrap-switch.js"></script>
	<!-- <script src="https://www.w3schools.com/lib/w3.js"></script>  -->

	<script>
		hljs.initHighlightingOnLoad();
		$('document').ready(function(){
			
			// w3.includeHTML();

			$('#environmentSelector').bootstrapSwitch({
			    on: 'Production', // default 'On'
			    off: 'Acceptation', // default 'Off'
			    same: true, // default false. same text for on/off and onLabel/offLabel
			    size: 'sm', // xs/sm/md/lg, default 'md'
			    onClass: 'success', //success/primary/danger/warning/default, default 'primary'
			    offClass: 'success', //success/primary/danger/warning/default default 'default'
			});

			$('.external-content').each(function(i, e) {
				$(e).load(e.dataset.source, function(){
					environmentChanged();
				});
			});

			$('.nav-tabs a').click(function(event){
				$(this).tab('show');
				secondary = $(this).data('target-menu');
				$('#menu-tab-content .tab-pane.active').removeClass('active');
				$(secondary).tab('show'); 
			});

		});

		function environmentChanged() {
			production = $('#environmentSelector').is(':checked');
			var namidpMetaProd = 'https://namidp.services.uu.nl/nidp/saml2/metadata';
			var namidpMetaAcc = 'https://anamidp.services.uu.nl/nidp/saml2/metadata'
			var logoutProd = 'http://logout.uu.nl';
			var logoutAcc = 'http://logout.acc.uu.nl';
			var generalIdpProd = 'namidp.services.uu.nl';
			var generalIdpAcc = 'anamidp.services.uu.nl';

			$namidpMeta = production ? namidpMetaProd : namidpMetaAcc;
			$logout = production ? logoutProd : logoutAcc;
			$general = production ? generalIdpProd : generalIdpAcc;

			$evn = production ? "On acceptation: " : "On production: ";
			$namIdpMetaTitle = $evn + (production ? namidpMetaAcc : namidpMetaProd);
			$logoutTitle = $evn + (production ? logoutAcc : logoutProd);
			$generalTitle = $evn + (production ? generalIdpAcc : generalIdpProd);

			$('.idp-base-link').html($general); $('.idp-base-link').prop("title", $generalTitle);
			$('.namidp-metadata-link').html($namidpMeta); $('.namidp-metadata-link').prop("title", $namIdpMetaTitle);
			$('.namidp-logout-link').html($logout); $('.namidp-logout-link').prop("title", $logoutTitle);
			$('a.namidp-metadata-active-link').html($namidpMeta); $('a.namidp-metadata-active-link').prop('href', $namidpMeta);

			addPopover('idp-base-link');
			addPopover('namidp-metadata-link');
			addPopover('namidp-logout-link');

			$('code').each(function(i, block){
				hljs.highlightBlock(block);
			});
		}

		function addPopover(el) {
			$('.' + el).prop('data-toggle', 'tooltip');
			$('.' + el).prop('data-placement', 'top');
			$('.' + el).tooltip();
		}
	</script>
	<body style="padding-top: 20px; padding-bottom: 50px; position: relative" data-spy="scroll" data-target="#scrollSpy">
		<div class="container">
			<div class="row">
				<div class="col-md-3 hidden-sm-down" id="scrollSpy" style="position: relative;">
					<div style="position: fixed;" class="tab-content" id="menu-tab-content">

						<!-- SimpleSamlPHP Menu -->
						<ul class="nav nav-list about-list hidden-phone hidden-tablet affix fixed tab-pane active" id="simplesaml-menu" role="tabpanel">
							<li><a href="#setup">Set-up SimpleSaml library</a></li>
							<li><a href="#examples">Using SimpleSaml in your Project</a>
								<ul>
									<li><a href="#req-auth">Require Authentication</a></li>
									<li><a href="#login">Login function</a></li>
									<li><a href="#Loginurl">Login URL</a></li>
									<li><a href="#logout">Loging out</a></li>
									<li><a href="#force auth">Force authentication</a></li>
								</ul>
							</li>
							<li><a href="#deviate">Deviate from the Single Sign-On</a></li>
						</ul>

						<!-- OneLogin menu -->
						<ul class="nav nav-list about-list hidden-phone hidden-tablet affix fixed tab-pane" 
							role="tabpanel" id="onelogin-python3-menu"
						>
							<li><a href="#setuppythonsaml">Set-up OneLogin Library</a></li>
							<li><a href="#onelogin-preparing-application">Preparing your project for OneLogin</a>
								<ul>
									<li><a href="#onelogin-auth-object">Setting up the auth object</a></li>
									<li><a href="#onelogin-metadata-page">Creating a metadata page</a></li>
								</ul>
							</li>
							<li><a href="#onelogin-contact-ITS">Contact ITS</a></li>
							<li><a href="#onelogin-use-in-project">Using OneLogin in your project</a>
								<ul>
									<li><a href="#onelogin-authenticate">Authenticate users in Python</a></li>
									<li><a href="#onelogin-process-response">Process the authentication response</a></li>
									<li><a href="#onelogin-check-auth-status">Checking authentication status</a></li>
									<li><a href="#python-logout">Logout</a></li>
								</ul>
							</li>
						</ul>

						<!-- Environment Switch -->
						<p>
						<br/>
						Environment:<br/>
						<input type="checkbox" id="environmentSelector" checked="checked" onchange="environmentChanged();"/>
						</p>

					</div>
				</div>
				<div class="col-md-9 col-sm-12">
						<h1 id="how-to-saml">how-to Saml</h1>
						<small style="padding-bottom: 100px; display: block; position: relative;">
							<div class="col-md-6 col-sm-12">
							Documentation written by <a href="http://uilots-labs.wp.hum.uu.nl/people/#AJM" target="_blank">A.J. de Mooij</a>.<br/>
							Lab Technician and Software Developar at <a href="https://uilots-labs.wp.hum.uu.nl/" target="_blank">Utrecht Institute of Linguistics OTS</a> (UiL OTS)<br/> 
							<a href="https://www.uu.nl/" target="_blank">Utrecht University</a>
							</div>
							<div class="col-md-6 col-sm-12">
							Special thanks to <a href="https://www.uu.nl/medewerkers/TPRdeHaas" target="_blank">T.P.R. de Haas</a>.<br/>Information and Technology Services.<br/><a href="https://www.uu.nl/" target="_blank">Utrecht University</a>
							</div>
						</small>
						<div class="row">
						<div class="col-xs 12 col-md-7">
						<p>This document tries to aggregate various how-to's in the topic of setting op SAML to talk to the Identity Provider of University Utrecht's ITS, and subsequently setting up a project to make use of the features offered by SAML.</p>
						<p>SAML (Security Assertion Markup Language) is an xml-based standard for allowing federated authentication. The Univerity Utrecht is slowly moving all its web applications from LDAP authentication to SAML. With SAML, the user is redirected to a login page of the university, so no passwords have to be sent over the server that hosts an application, while still allowing Solis-ID authentication.</p>
						<p>SAML consists of two parts: The Identity Provider (IdP) and the Service Provider (SP). The Identity Provider is hosted by the university. The Service Provider rests with the application, and communicates with the Identity Provider.</p>
						<p>This how-to tries to describe how to set up a SAML Service Provider to communicate with the universities Identity Provider using various libraries in various programming languages. You are welcome to contribute guides for other libraries or programming languages, such as
							<a href="https://github.com/onelogin/python-saml" target="_blank">Python</a>,
							<a href="https://github.com/onelogin/java-saml" target="_blank">Java</a>,
							<a href="https://github.com/onelogin/ruby-saml" target="_blank">Ruby</a>,
							<a href="https://github.com/onelogin/wordpress-saml" target="_blank">Wordpress</a>, etc
							).</p>

						<p>In the left menu you can select the production or acceptation environment for this how-to (<a href="#environmentCollapse" data-toggle="collapse" aria-expaned="false">read more</a>)</p>
						</div>
						<div class="col-xs-12 col-md-5">
							<div class="card">
								<div class="card-block">
								<h4 class="card-title">Join the cause!</h4>
								<p class="card-text">This how-to currently only describes implementing SAML into your application using the PHP Library SimpleSaml PHP. For many other programming languages, implementations exist as well. For example, <a href="https://github.com/onelogin/" target="_blank">OneLogin</a> provides such libraries for many languages.</p>
								<p class="card-text">The aim of this repository is to give guidance in implementing SAML into an application of <i>any</i> language. Did this how-to help you, but did you end up using a library not yet documented in this how-to, or do you want to suggest improvements?</p><p><strong>Then please help us</strong> by cloning <a href="https://github.com/UiL-OTS-labs-backoffice/SimpleSAML-Example-And-Documentation" target="_blank">this repository</a>, creating minimal code examples for the used programming language or updating the how-to and create a pull request.
								</div>
							</div>
						</div>
						</div>
						<div class="collapse" id="environmentCollapse">
							<div class="card">
								<div class="card-block">
									<p>ITS provides two environments. The production environment contains all Solis-IDs available for employees and students of Utrecht University and is more strict in how it can be used. For development and acceptation, an acceptation invironment is available. This environment is slightly less strict, which works well for development, but does not contain default Solis-ID's. Instead, you have to work with test accounts, which ITS can create for you.</p>
									<p>In the side menu, you can choose to read this how-to for production or for acceptation. The required URLS are automatically adapted for the environment you chose. Except for in the code boxes, howevering a url will show the value for the other environment, if it differs from the selected environment.</p>
									<p>In the code examples which you can find in the repository, the acceptation environment is always used. To test the examples for production, you will have to adapt the code to production.</p>
								</div>
							</div>
						</div>

						<ul class="nav nav-tabs">
							<li class="nav-item">
								<a class="nav-link active" data-toggle="tab" href="#simplesaml" data-target="#simplesaml" data-target-menu="#simplesaml-menu">
									SimpleSamlPHP
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" data-toggle="tab" href="#onelogin-python3" data-target="#onelogin-python3" 
									data-target-menu="#onelogin-python3-menu">
									OneLogin Python3
								</a>
							</li>
						</ul>

						<div class="tab-content" id="HowToContent">
							<div data-source="simplesaml.html" id="simplesaml" class="tab-pane simple-saml-php external-content active" role="tabpanel"></div>
							<div data-source="onelogin-python3.html" id="onelogin-python3" class="tab-pane onelogin-python3 external-content" 
								role="tabpanel">
							</div>
						</div>

						
					</div>
				</div>
			</div>
	</body>
</html>